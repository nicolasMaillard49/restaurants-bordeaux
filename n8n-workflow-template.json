{
  "name": "Scraping Restaurants Bordeaux",
  "description": "Workflow automatisé pour scraper les restaurants de Bordeaux et les envoyer à l'API",
  "nodes": [
    {
      "name": "Manuel Trigger",
      "type": "n8n-nodes-base.manualTrigger",
      "notes": "Démarrage manuel du workflow (ou remplacer par un Cron pour automatisation)"
    },
    {
      "name": "Google Maps Search",
      "type": "n8n-nodes-base.code",
      "notes": "Code Playwright pour rechercher 'meilleurs restaurants Bordeaux' sur Google Maps"
    },
    {
      "name": "Loop Restaurants",
      "type": "n8n-nodes-base.splitInBatches",
      "notes": "Traiter les restaurants un par un"
    },
    {
      "name": "Extract Data",
      "type": "n8n-nodes-base.code",
      "notes": "Playwright pour extraire : nom, note, adresse, lien site"
    },
    {
      "name": "Visit Website",
      "type": "n8n-nodes-base.httpRequest",
      "notes": "Récupérer le contenu HTML du site officiel"
    },
    {
      "name": "Extract Images & Description",
      "type": "n8n-nodes-base.code",
      "notes": "Playwright pour extraire description et images depuis le site"
    },
    {
      "name": "Clean with OpenAI",
      "type": "n8n-nodes-base.openAi",
      "notes": "Reformuler la description de manière SEO et professionnelle",
      "parameters": {
        "model": "gpt-4",
        "prompt": "Tu es un rédacteur web spécialisé en gastronomie. Reformule cette description de restaurant de manière professionnelle, SEO-friendly et engageante en 2-3 paragraphes. Garde un ton neutre et informatif.\n\nDescription originale : {{$json.description}}"
      }
    },
    {
      "name": "Prepare JSON",
      "type": "n8n-nodes-base.set",
      "notes": "Formater les données pour l'API",
      "parameters": {
        "values": {
          "name": "={{ $json.name }}",
          "description": "={{ $json.cleaned_description }}",
          "rating": "={{ $json.rating }}",
          "address": "={{ $json.address }}",
          "city": "Bordeaux",
          "website": "={{ $json.website }}",
          "images": "={{ $json.images }}",
          "source": "google_maps"
        }
      }
    },
    {
      "name": "Import to API",
      "type": "n8n-nodes-base.httpRequest",
      "notes": "Envoyer à POST /scraper/import",
      "parameters": {
        "method": "POST",
        "url": "http://backend:3000/scraper/import",
        "authentication": "none",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "x-api-key",
              "value": "={{ $env.API_SECRET_KEY }}"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "body",
              "value": "={{ JSON.stringify($json) }}"
            }
          ]
        }
      }
    },
    {
      "name": "Log Success",
      "type": "n8n-nodes-base.code",
      "notes": "Logger le succès de l'import"
    }
  ],
  "connections": {
    "Manuel Trigger": {
      "main": [[{ "node": "Google Maps Search", "type": "main", "index": 0 }]]
    },
    "Google Maps Search": {
      "main": [[{ "node": "Loop Restaurants", "type": "main", "index": 0 }]]
    },
    "Loop Restaurants": {
      "main": [[{ "node": "Extract Data", "type": "main", "index": 0 }]]
    },
    "Extract Data": {
      "main": [[{ "node": "Visit Website", "type": "main", "index": 0 }]]
    },
    "Visit Website": {
      "main": [[{ "node": "Extract Images & Description", "type": "main", "index": 0 }]]
    },
    "Extract Images & Description": {
      "main": [[{ "node": "Clean with OpenAI", "type": "main", "index": 0 }]]
    },
    "Clean with OpenAI": {
      "main": [[{ "node": "Prepare JSON", "type": "main", "index": 0 }]]
    },
    "Prepare JSON": {
      "main": [[{ "node": "Import to API", "type": "main", "index": 0 }]]
    },
    "Import to API": {
      "main": [[{ "node": "Log Success", "type": "main", "index": 0 }]]
    }
  },
  "settings": {
    "executionOrder": "v1"
  },
  "tags": ["scraping", "restaurants", "automation"]
}
